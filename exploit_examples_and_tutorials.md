# Exploit examples and tutorials

Okay, so in the other chapters we have learned a bit about gdb and a bit about assembly. And some other stuff. But the best way is to practice and practice and practice. So that is what we are going to do now.


### Buffer overflow

So this is the program that we are going to exploit.
```# include <stdio.h>
# include <string.h>


int main(int argc, char const *argv[]) {
  char buff[256];
  strcpy(buff, argv[1]);
  printf("%s\n", buff);
  return 0;
}
```

1. Find the buff in memory.
2. Find the size of buff in memory
3. Create shellcode-exploit.
4. ???
5. Profit!

Let's open up the program with gdb.
`gdb -q buffOverflow` - `-q` for quiet.

```
(gdb) disassemble main
Dump of assembler code for function main:
   0x0000000000400536 <+0>:	push   rbp
   0x0000000000400537 <+1>:	mov    rbp,rsp
   0x000000000040053a <+4>:	sub    rsp,0x110
   0x0000000000400541 <+11>:	mov    DWORD PTR [rbp-0x104],edi
   0x0000000000400547 <+17>:	mov    QWORD PTR [rbp-0x110],rsi
   0x000000000040054e <+24>:	mov    rax,QWORD PTR [rbp-0x110]
   0x0000000000400555 <+31>:	add    rax,0x8
   0x0000000000400559 <+35>:	mov    rdx,QWORD PTR [rax]
   0x000000000040055c <+38>:	lea    rax,[rbp-0x100]
   0x0000000000400563 <+45>:	mov    rsi,rdx
   0x0000000000400566 <+48>:	mov    rdi,rax
   0x0000000000400569 <+51>:	call   0x400400 <strcpy@plt>
   0x000000000040056e <+56>:	lea    rax,[rbp-0x100]
   0x0000000000400575 <+63>:	mov    rdi,rax
   0x0000000000400578 <+66>:	call   0x400410 <puts@plt>
   0x000000000040057d <+71>:	mov    eax,0x0
   0x0000000000400582 <+76>:	leave  
   0x0000000000400583 <+77>:	ret    
End of assembler dump.
```

This is not too intimidating. We understand the basics of what's going on here. What we are interested in in this case is the vulnerable function strcpy. And we can see that it can be found at this address: `   0x0000000000400569 <+51>:	call   0x400400 <strcpy@plt>`. That's good. Now let's add a breakpoint right below. `break *0x000000000040056e`
Now let's run the program.
`run hello`
The program then stops at our breakpoint. And we are now able to look at the stack and see what it going on so far.
`x/200xb $rsp`

```
(gdb) x/200xb $rsp
0x7fffffffe560:	0x58	0xe7	0xff	0xff	0xff	0x7f	0x00	0x00
0x7fffffffe568:	0x88	0xe1	0xff	0xf7	0x02	0x00	0x00	0x00
0x7fffffffe570:	0x68	0x65	0x6c	0x6c	0x6f	0x00	0x00	0x00
0x7fffffffe578:	0x90	0xe5	0xff	0xff	0xff	0x7f	0x00	0x00
0x7fffffffe580:	0x26	0xb0	0x62	0x65	0x00	0x00	0x00	0x00
0x7fffffffe588:	0x00	0x00	0x00	0x00	0x00	0x00	0x00	0x00
0x7fffffffe590:	0xe0	0xe4	0xff	0xf7	0xff	0x7f	0x00	0x00
0x7fffffffe598:	0xd0	0xe5	0xff	0xff	0xff	0x7f	0x00	0x00
0x7fffffffe5a0:	0x80	0xa2	0xff	0xf7	0x01	0x00	0x00	0x00
0x7fffffffe5a8:	0xc0	0xe5	0xff	0xff	0xff	0x7f	0x00	0x00
0x7fffffffe5b0:	0x2e	0x4e	0x3d	0xf6	0x00	0x00	0x00	0x00
0x7fffffffe5b8:	0x0f	0x03	0x40	0x00	0x00	0x00	0x00	0x00
0x7fffffffe5c0:	0xff	0xff	0xff	0xff	0x00	0x00	0x00	0x00
0x7fffffffe5c8:	0x0b	0xb4	0x01	0x36	0x63	0x2a	0x00	0x00
0x7fffffffe5d0:	0x30	0x73	0xa4	0xf7	0xff	0x7f	0x00	0x00
0x7fffffffe5d8:	0xc0	0x74	0xff	0xf7	0xff	0x7f	0x00	0x00
0x7fffffffe5e0:	0x00	0x00	0x00	0x00	0x00	0x00	0x00	0x00
0x7fffffffe5e8:	0x00	0x00	0x00	0x00	0x00	0x00	0x00	0x00
0x7fffffffe5f0:	0x70	0xe7	0xff	0xff	0xff	0x7f	0x00	0x00
0x7fffffffe5f8:	0x00	0x00	0x00	0x00	0x00	0x00	0x00	0x00
0x7fffffffe600:	0x01	0x00	0x00	0x00	0x00	0x00	0x00	0x00
0x7fffffffe608:	0x70	0xe7	0xff	0xff	0xff	0x7f	0x00	0x00
0x7fffffffe610:	0x02	0x00	0x00	0x00	0x00	0x00	0x00	0x00
0x7fffffffe618:	0x90	0xe6	0xff	0xff	0xff	0x7f	0x00	0x00
0x7fffffffe620:	0x88	0xe1	0xff	0xf7	0xff	0x7f	0x00	0x00
```

Okay, I am not sure where anything here is. So it is better to enter something that we can easily recognize. So let's run the program again but this time our input will be lots of A's.

`run $(python -c 'print "A"*100')`
So here we are opening up a shell when we are running the command, and within that shell we launch python and asks it to run without the interactive shell. So we print out 100 A's.

The breakpoint we set up is till active, so the program stops just after the command-line argument has been copied into the buff-array-variable. 





